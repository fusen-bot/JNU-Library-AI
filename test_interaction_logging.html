<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’æ—¥å¿—è®°å½•åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-title {
            color: #333;
            border-bottom: 2px solid #05a081;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .book-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .book-item:hover {
            border-color: #05a081;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .book-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .book-author {
            color: #666;
            font-size: 14px;
        }
        
        .detail-panel {
            display: none;
            background: #f8f9fa;
            border: 1px solid #05a081;
            border-radius: 8px;
            padding: 20px;
            margin-top: 10px;
        }
        
        .button {
            background: #05a081;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .button:hover {
            background: #046e5c;
        }
        
        .stats-display {
            background: #e8f4f2;
            border: 1px solid #05a081;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .log-display {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç”¨æˆ·äº¤äº’è¡Œä¸ºæ—¥å¿—è®°å½•åŠŸèƒ½æµ‹è¯•</h1>
    
    <!-- æ¨¡æ‹Ÿæœç´¢åŒºåŸŸ -->
    <div class="test-section">
        <h2 class="test-title">1. æ£€ç´¢è€—æ—¶æµ‹è¯•</h2>
        <p>åœ¨ä¸‹é¢çš„è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œæ¨¡æ‹Ÿæœç´¢è¿‡ç¨‹ï¼š</p>
        <input type="text" class="search-input" id="search-input" placeholder="è¾“å…¥ä¹¦ç±å…³é”®è¯è¿›è¡Œæœç´¢...">
        <button class="button" onclick="simulateSearch()">å¼€å§‹æœç´¢</button>
        <button class="button" onclick="showResults()">æ˜¾ç¤ºç»“æœ</button>
        <div id="search-status"></div>
    </div>

    <!-- æ¨¡æ‹Ÿæ¨èç»“æœåŒºåŸŸ -->
    <div class="test-section">
        <h2 class="test-title">2. ç»“æœé¡µé¢åœç•™æ—¶é•¿æµ‹è¯•</h2>
        <p>ä¸‹é¢æ˜¯æ¨¡æ‹Ÿçš„æ¨èç»“æœåŒºåŸŸï¼Œç”¨äºæµ‹è¯•åœç•™æ—¶é•¿ï¼š</p>
        <div id="results-area" style="display: none;">
            <div class="book-item" data-book-id="book1" onmouseenter="showPanel('book1')" onmouseleave="hidePanel('book1')">
                <div class="book-title">ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</div>
                <div class="book-author">ä½œè€…: Randal E. Bryant</div>
                <div class="detail-panel" id="panel-book1">
                    <h4>ğŸ“– ä¹¦ç±è¯¦æƒ…é¢æ¿</h4>
                    <p>è¿™æ˜¯ä¸€æœ¬å…³äºè®¡ç®—æœºç³»ç»Ÿçš„ç»å…¸æ•™æ...</p>
                    <p>å°†é¼ æ ‡æ‚¬åœåœ¨è¿™é‡Œæµ‹è¯•é¢æ¿åœç•™æ—¶é•¿è®°å½•</p>
                </div>
            </div>
            
            <div class="book-item" data-book-id="book2" onmouseenter="showPanel('book2')" onmouseleave="hidePanel('book2')">
                <div class="book-title">ã€Šç®—æ³•å¯¼è®ºã€‹</div>
                <div class="book-author">ä½œè€…: Thomas H. Cormen</div>
                <div class="detail-panel" id="panel-book2">
                    <h4>ğŸ“– ä¹¦ç±è¯¦æƒ…é¢æ¿</h4>
                    <p>ç®—æ³•é¢†åŸŸçš„æƒå¨æ•™æ...</p>
                    <p>å°†é¼ æ ‡æ‚¬åœåœ¨è¿™é‡Œæµ‹è¯•é¢æ¿åœç•™æ—¶é•¿è®°å½•</p>
                </div>
            </div>
            
            <div class="book-item" data-book-id="book3" onmouseenter="showPanel('book3')" onmouseleave="hidePanel('book3')">
                <div class="book-title">ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹</div>
                <div class="book-author">ä½œè€…: Cay S. Horstmann</div>
                <div class="detail-panel" id="panel-book3">
                    <h4>ğŸ“– ä¹¦ç±è¯¦æƒ…é¢æ¿</h4>
                    <p>Javaç¼–ç¨‹çš„å®ç”¨æŒ‡å—...</p>
                    <p>å°†é¼ æ ‡æ‚¬åœåœ¨è¿™é‡Œæµ‹è¯•é¢æ¿åœç•™æ—¶é•¿è®°å½•</p>
                </div>
            </div>
        </div>
        <button class="button" onclick="hideResults()">éšè—ç»“æœ</button>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="test-section">
        <h2 class="test-title">3. å®æ—¶ç»Ÿè®¡ä¿¡æ¯</h2>
        <button class="button" onclick="updateStats()">åˆ·æ–°ç»Ÿè®¡</button>
        <button class="button" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <div id="stats-display" class="stats-display">
            <p>ç‚¹å‡»"åˆ·æ–°ç»Ÿè®¡"æŸ¥çœ‹å½“å‰ä¼šè¯çš„ç»Ÿè®¡ä¿¡æ¯</p>
        </div>
    </div>

    <!-- åŸå§‹æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="test-section">
        <h2 class="test-title">4. åŸå§‹æ—¥å¿—è¾“å‡º</h2>
        <div id="log-display" class="log-display">
            <p>æ—¥å¿—ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
        </div>
    </div>

    <!-- åŠ è½½äº¤äº’æ—¥å¿—è®°å½•å™¨ -->
    <script src="interaction_logger.js"></script>
    
    <script>
        // æµ‹è¯•åŠŸèƒ½å®ç°
        let searchTimeout;
        let resultsVisible = false;
        
        // æ¨¡æ‹Ÿæœç´¢åŠŸèƒ½
        function simulateSearch() {
            const input = document.getElementById('search-input');
            const query = input.value.trim();
            
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            // å¼€å§‹æœç´¢è®¡æ—¶
            if (window.interactionLogger) {
                window.interactionLogger.setCurrentQuery(query);
                window.interactionLogger.startSearch();
            }
            
            const statusDiv = document.getElementById('search-status');
            statusDiv.innerHTML = '<p style="color: #05a081;">ğŸ” æ­£åœ¨æœç´¢ä¸­...</p>';
            
            // æ¨¡æ‹Ÿæœç´¢å»¶è¿Ÿ
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                statusDiv.innerHTML = '<p style="color: #28a745;">âœ… æœç´¢å®Œæˆï¼ç‚¹å‡»"æ˜¾ç¤ºç»“æœ"æŸ¥çœ‹æ¨è</p>';
            }, 1000 + Math.random() * 2000); // 1-3ç§’çš„éšæœºå»¶è¿Ÿ
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function showResults() {
            const resultsArea = document.getElementById('results-area');
            resultsArea.style.display = 'block';
            resultsVisible = true;
            
            // ç»“æŸæœç´¢è®¡æ—¶ï¼Œå¼€å§‹ç»“æœé¡µé¢è®¡æ—¶
            if (window.interactionLogger) {
                window.interactionLogger.endSearch();
                window.interactionLogger.resultsDisplayed();
            }
            
            updateLogDisplay('ğŸ“„ æ˜¾ç¤ºæœç´¢ç»“æœ');
        }
        
        // éšè—æœç´¢ç»“æœ
        function hideResults() {
            const resultsArea = document.getElementById('results-area');
            resultsArea.style.display = 'none';
            resultsVisible = false;
            
            // è®°å½•ç»“æœé¡µé¢éšè—
            if (window.interactionLogger) {
                window.interactionLogger.resultsHidden();
            }
            
            updateLogDisplay('ğŸ“„ éšè—æœç´¢ç»“æœ');
        }
        
        // æ˜¾ç¤ºä¹¦ç±è¯¦æƒ…é¢æ¿
        function showPanel(bookId) {
            const panel = document.getElementById(`panel-${bookId}`);
            panel.style.display = 'block';
            
            // è®°å½•é¢æ¿æ‰“å¼€
            if (window.interactionLogger) {
                const bookTitle = panel.parentElement.querySelector('.book-title').textContent;
                window.interactionLogger.panelOpened(bookId, bookTitle);
            }
            
            updateLogDisplay(`ğŸ“– æ‰“å¼€ä¹¦ç±é¢æ¿: ${bookId}`);
        }
        
        // éšè—ä¹¦ç±è¯¦æƒ…é¢æ¿
        function hidePanel(bookId) {
            const panel = document.getElementById(`panel-${bookId}`);
            panel.style.display = 'none';
            
            // è®°å½•é¢æ¿å…³é—­
            if (window.interactionLogger) {
                window.interactionLogger.panelClosed();
            }
            
            updateLogDisplay(`ğŸ“– å…³é—­ä¹¦ç±é¢æ¿: ${bookId}`);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            if (!window.interactionLogger) {
                document.getElementById('stats-display').innerHTML = '<p style="color: red;">âŒ äº¤äº’æ—¥å¿—è®°å½•å™¨æœªåŠ è½½</p>';
                return;
            }
            
            const stats = window.interactionLogger.getSessionStats();
            const statsHtml = `
                <h4>ğŸ“Š ä¼šè¯ç»Ÿè®¡ä¿¡æ¯</h4>
                <p><strong>ä¼šè¯ID:</strong> ${stats.sessionId}</p>
                
                <h5>ğŸ” æœç´¢ç»Ÿè®¡:</h5>
                <ul>
                    <li>æ€»æœç´¢æ¬¡æ•°: ${stats.searchStats.totalCount}</li>
                    <li>æ€»æœç´¢è€—æ—¶: ${stats.searchStats.totalDuration}ms</li>
                    <li>å¹³å‡æœç´¢è€—æ—¶: ${stats.searchStats.averageDuration}ms</li>
                </ul>
                
                <h5>ğŸ“„ ç»“æœé¡µé¢ç»Ÿè®¡:</h5>
                <ul>
                    <li>æ€»åœç•™æ—¶é•¿: ${stats.resultsStats.totalDisplayDuration}ms</li>
                    <li>å½“å‰æ˜¯å¦æ˜¾ç¤º: ${stats.resultsStats.currentlyDisplayed ? 'æ˜¯' : 'å¦'}</li>
                </ul>
                
                <h5>ğŸ“– é¢æ¿ç»Ÿè®¡:</h5>
                <ul>
                    <li>æ€»é¢æ¿åœç•™æ—¶é•¿: ${stats.panelStats.totalDuration}ms</li>
                    <li>å·²æŸ¥çœ‹çš„ä¹¦ç±æ•°é‡: ${stats.panelStats.uniqueBooksViewed}</li>
                    <li>å½“å‰æ˜¯å¦æœ‰é¢æ¿æ‰“å¼€: ${stats.panelStats.currentlyOpen ? 'æ˜¯' : 'å¦'}</li>
                </ul>
                
                <h5>ğŸ“š å„ä¹¦ç±åœç•™æ—¶é•¿:</h5>
                <ul>
                    ${Object.entries(stats.panelStats.bookDurations).map(([bookId, duration]) => 
                        `<li>${bookId}: ${duration}ms</li>`
                    ).join('') || '<li>æš‚æ— æ•°æ®</li>'}
                </ul>
            `;
            
            document.getElementById('stats-display').innerHTML = statsHtml;
        }
        
        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            document.getElementById('log-display').innerHTML = '<p>æ—¥å¿—å·²æ¸…é™¤</p>';
        }
        
        // æ›´æ–°æ—¥å¿—æ˜¾ç¤º
        function updateLogDisplay(message) {
            const logDiv = document.getElementById('log-display');
            const timestamp = new Date().toLocaleTimeString();
            const newLog = `<div>[${timestamp}] ${message}</div>`;
            logDiv.innerHTML = newLog + logDiv.innerHTML;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            updateLogDisplay('ğŸ“Š æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // æ£€æŸ¥äº¤äº’æ—¥å¿—è®°å½•å™¨æ˜¯å¦æ­£å¸¸åŠ è½½
            setTimeout(() => {
                if (window.interactionLogger) {
                    updateLogDisplay('âœ… äº¤äº’æ—¥å¿—è®°å½•å™¨å·²æˆåŠŸåŠ è½½');
                    updateStats();
                } else {
                    updateLogDisplay('âŒ äº¤äº’æ—¥å¿—è®°å½•å™¨åŠ è½½å¤±è´¥');
                }
            }, 1000);
        });
        
        // å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        setInterval(updateStats, 5000);
    </script>
</body>
</html>
